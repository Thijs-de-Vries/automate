# Automate Project Backlog
# Issues are removed once completed (tracked in git commits)

# Template for new issues:
# - id: unique-kebab-case-id
#   title: Brief descriptive title
#   description: Detailed description of the issue
#   priority: Critical | High | Medium | Low
#   status: open | in-progress | blocked
#   affected_files:
#     - path/to/file.ts
#     - path/to/another/file.tsx
#   notes: Optional additional context

# Compact index (one-liner per issue; keep in sync with issues list)
index:
  - "[Critical][open] connection-indicator-missing — No Convex connection status indicator"
  - "[High][open] notifications-system-broken — Push notifications not working"
  - "[Medium][open] query-error-handling-missing — No error handling for failed queries"
  - "[Medium][open] mutation-error-feedback-poor — Mutation errors shown as alerts or silent failures"
  - "[High][open] env-vars-not-validated — Environment variables not validated at startup"
  - "[High][open] service-worker-hook-unused — useServiceWorker hook exists but never used"

issues:
  - id: connection-indicator-missing
    title: No Convex connection status indicator
    description: |
      When app is restarted or wakes from idle, Convex needs to reconnect but there's no visual indicator.
      Users see blank screens or stale data without knowing if connection is active/reconnecting.
      Need persistent banner similar to OfflineBanner.tsx for connection states.
    priority: Critical
    status: open
    affected_files:
      - src/main.tsx
      - src/App.tsx
      - src/contexts/SpaceContext.tsx
    notes: |
      Should distinguish between:
      - Network offline (existing OfflineBanner)
      - Convex connecting/reconnecting
      - Convex connection failed
      Mobile-first design required.

  - id: notifications-system-broken
    title: Push notifications not working
    description: |
      Notification system exists but not functioning properly.
      Users not receiving push notifications for apartment items, comments, etc.
      Service worker handles push events but registration/subscription may be broken.
    priority: High
    status: open
    affected_files:
      - src/sw.ts
      - src/hooks/usePushNotifications.ts
      - convex/notifications.ts
      - convex/notificationsNode.ts
    notes: |
      Check:
      - Push subscription registration
      - Notification permissions
      - Convex notification sending logic
      - Service worker push event handling
      Apartment module notification logic has been simplified to minimal strategy:
      - No notifications on item submit (less noisy)
      - Notify submitter when item purchased (if different person)
      - Notify previous commenters on new comments

  - id: query-error-handling-missing
    title: No error handling for failed queries
    description: |
      All useQuery calls use `?? []` or `?? undefined` fallback pattern which masks errors.
      Users can't tell if data failed to load vs. actually empty.
      No retry UI for failed queries.
    priority: Medium
    status: open
    affected_files:
      - src/apps/tasks/TasksApp.tsx
      - src/apps/apartment/ApartmentApp.tsx
      - src/apps/packing/PackingApp.tsx
      - src/apps/public-transport/PublicTransportApp.tsx
      - src/apps/calisthenics/CalisthenicsApp.tsx
    notes: |
      Need consistent pattern for:
      - Loading state
      - Error state with retry button
      - Empty state
      Reference PublicTransportApp.tsx for good error handling example.

  - id: mutation-error-feedback-poor
    title: Mutation errors shown as alerts or silent failures
    description: |
      Most mutations wrapped in try/catch with only console.log or alert() for errors.
      Need toast notification system for better UX.
      Loading states inconsistent across apps.
    priority: Medium
    status: open
    affected_files:
      - src/apps/tasks/TasksApp.tsx
      - src/apps/apartment/ApartmentApp.tsx
      - src/apps/packing/PackingApp.tsx
      - src/apps/calisthenics/CalisthenicsApp.tsx
    notes: |
      Consider:
      - Shadcn toast/sonner component
      - Standardized useMutation wrapper with error handling
      - Loading button states

  - id: env-vars-not-validated
    title: Environment variables not validated at startup
    description: |
      App uses multiple env vars (VITE_CONVEX_URL, VITE_CLERK_PUBLISHABLE_KEY, VAPID keys, NS_API_KEY)
      but doesn't validate they exist at startup. Missing env vars cause cryptic runtime errors.
      Users report blank screens which could be missing CONVEX_URL.
    priority: High
    status: open
    affected_files:
      - src/main.tsx
      - convex/notificationsNode.ts
      - convex/publicTransportActions.ts
    notes: |
      Add validation at app startup:
      - Check required env vars exist
      - Show user-friendly error if missing
      - Prevent app initialization with bad config

  - id: service-worker-hook-unused
    title: useServiceWorker hook exists but never used
    description: |
      src/hooks/useServiceWorker.ts is implemented but not imported anywhere.
      Part of the update-mechanism-fragmented issue. Should be integrated.
    priority: High
    status: open
    affected_files:
      - src/hooks/useServiceWorker.ts
      - src/contexts/UpdateContext.tsx
    notes: |
      Related to update-mechanism-fragmented issue.
      Integrate with UpdateContext to unify SW and version checking.

